<!-- TODO
âœ… 1. Fix alignment on input box
âœ…2. Fix algorithm for scoring
âœ…3. Make everything bigger
âœ… 4. Add a box at the top indicating how many points a column is.
âœ…5. Limit to only 2 of each letter and only 2 special chars
6. Better theme and colours
âœ… 7. Bug with it miscounting letters 
âœ… 8. Add a little (i) icon in the top right that explains how to play in 2 sentences
9. Highlight the letters on the board that have been used in the input word
10. refresh button for a new round??
11. Timer looks cooler
12. remove scoring to be in the top of scored-words box
-->


<!-- Potential colour palette

Dark Navy (main background): #0A1929
Deep Maroon: #4A0E2E
Rich Brown: #3A2618
Lighter Navy (secondary background): #1A2A3A
Soft Gold (highlight): #D4AF37
Pale Blue-Gray (text): #C0C5CA
Off-White (text and highlights): #F0F0F0


Use #0A1929 (Dark Navy) as your primary background color
Use #1A2A3A (Lighter Navy) for secondary backgrounds or hover states
Use #4A0E2E (Deep Maroon) and #3A2618 (Rich Brown) for accents or important UI elements
Use #D4AF37 (Soft Gold) for highlights, buttons, or interactive elements
Use #C0C5CA (Pale Blue-Gray) for main body text
Use #F0F0F0 (Off-White) for headings or to create contrast against darker backgrounds

-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cnsntns Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1A2A3A;
            min-height: 100vh;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 80px 10px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .game-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            transform: scale(var(--vw-scale));
            
        }
        .board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .letter {
            width: 60px;
            height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            background-color: #e0e0e0;
            border-radius: 5px;
            position: relative;
        }
        .scores{
            border: 2px solid #061526;
            background-color: #061526;
            color: #f5edcc;
        }
        
        .scores::after {
            content: '\25BC';  /* Unicode for down triangle */
            position: absolute;
            bottom: -16px;
            font-size: 12px;
            color: #061526;
        }
        
        .letter.uncommon { background-color: #ffcccb; }
        .letter.very-uncommon { background-color: #ffa07a; }
        .bonus {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            background-color: #4CAF50;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
        }
        input {
            width: 100%;
            width: calc(100% - 20px);
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        #score {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* Info panel */
        .info-container {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            align-items: center;
            flex-direction: row-reverse;
        }
        
        .info-icon {
            width: 24px;
            height: 24px;
            background-color: #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border: none;
            padding: 0;
            font-size: 16px;
        }
        .rules-popover {
            width: 250px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .rules-popover h3 {
            margin-top: 0;
        }
        .rules-popover ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        li{
            padding-bottom: 13px;
        }
        
        :popover-open {
            position: absolute;
            inset: unset;
            top: 10px;
            right: 45px;
            margin: 0;
        }
        
        /* Timer styles - floating above */
        .timer-box {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }
        
        #timerDisplay {
            font-size: 28px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        
        #startTimer {
            padding: 8px 16px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #startTimer:hover {
            background-color: #45a049;
        }
        
        #startTimer:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Bell overlay */
        .bell-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-size: 120px;
        }
        
        .bell-overlay.show {
            display: flex;
        }
        
        .bell-overlay.jiggle {
            animation: jiggle 0.5s infinite;
        }
        
        @keyframes jiggle {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) scale(1.1); }
            50% { transform: rotate(10deg) scale(1.2); }
            75% { transform: rotate(-5deg) scale(1.1); }
        }
        
        .board-container {
            position: relative;
        }
        
        /* Scoring list - side box */
        .scored-words-box {
            width: 100%;
            max-width: 300px;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            overflow-y: auto;
            order: 2;
        }
        
        /* Wide screens: side by side layout */
        @media (min-width: 900px) {
            body {
                padding: 80px 20px 20px;
            }
            
            .main-content {
                flex-direction: row;
                align-items: flex-start;
                justify-content: center;
            }
            
            .game-container {
                order: 2;
                flex: 0 0 auto;
            }
            
            .scored-words-box {
                order: 1;
                width: 250px;
                max-height: calc(100vh - 100px);
                position: sticky;
                top: 80px;
            }
        }
        
        .scored-words-box h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        #scoredWordsList {
            font-size: 14px;
        }
        
        .scored-word-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        /* Reset button */
        .reset-icon {
            width: 24px;
            height: 24px;
            background-color: #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border: none;
            padding: 0;
            font-size: 16px;
        }
        
        .reset-icon:hover {
            background-color: #aaa;
        }
        
    </style>
</head>
<body>
    <div class="info-container">
        <button class="info-icon" popovertarget="rulesPopover">i</button>
        <button class="reset-icon" id="resetButton" title="Reset Game">â†»</button>
        <div id="rulesPopover" popover class="rules-popover">
            <h3>Game Rules:</h3>
            <ul>
                <li>Create words using the 8 displayed letters</li>
                <li>Add any other letters or vowels as needed (even if not shown) to complete your word!</li>
                <li>Score points <b>only</b> for letters on the board (if a letter appears twice you get scored for it twice).</li>
                <!-- <li>Calculate each player's score by typing it in</li> -->
            </ul>
            <p>The player with the highest score wins!</p>
        </div>
    </div>
    
    <div class="timer-box">
        <button id="startTimer">Start Timer</button>
        <div id="timerDisplay">30</div>
    </div>
    
    <div class="main-content">
        <div class="game-container">
        <div class="board">
            <div class="letter scores">5</div>
            <div class="letter scores">4</div>
            <div class="letter scores">3</div>
            <div class="letter scores">2</div>
        </div>
        
        <div class="board-container">
            <div class="board" id="board">
                
            </div>
            <div class="bell-overlay" id="bellOverlay">ðŸ””</div>
        </div>
        <input type="text" id="wordInput" placeholder="Enter your word to find your score">
        <div id="score">Score: 0</div>
        </div>
        
        <div class="scored-words-box">
            <h3>Scored Words</h3>
            <div id="scoredWordsList"></div>
        </div>
    </div>
    
    <script>
        const consonants = 'BCDFGHJKLMNPQRSTVWXYZ';
        const uncommonLetters = ['F', 'V', 'W'];
        const veryUncommonLetters = ['Q', 'X'];
        const columnScores = [5, 4, 3, 2];
        let currentBoard = [];
        
        // Weighted letter distribution - common letters appear 3x more frequently
        const commonConsonants = 'BCDFGHKLMNPRST'; // Common consonants
        const rareConsonants = 'QXJZVWY'; // Rare consonants (already very uncommon)
        
        // Timer variables
        let timerInterval = null;
        let timeRemaining = 30;
        let isTimerRunning = false;
        
        // Scoring list
        let scoredWords = [];
        
        function getWeightedRandomLetter() {
            // Create weighted array: common letters appear 3x more frequently
            const weightedLetters = [];
            
            // Add common letters 3 times
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < commonConsonants.length; j++) {
                    weightedLetters.push(commonConsonants[j]);
                }
            }
            
            // Add rare letters 1 time
            for (let i = 0; i < rareConsonants.length; i++) {
                weightedLetters.push(rareConsonants[i]);
            }
            
            // Pick random letter from weighted array
            return weightedLetters[Math.floor(Math.random() * weightedLetters.length)];
        }
        
        function generateBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            currentBoard = [];
            let letterCounts = {};
            let uncommonCount = 0;
            
            // Pick 8 letters using weighted distribution
            while (currentBoard.length < 8) {
                const letter = getWeightedRandomLetter();
                
                // Check if we've already used this letter twice
                if (letterCounts[letter] && letterCounts[letter] >= 2) {
                    continue;
                }
                
                // Check if it's an uncommon or very uncommon letter
                const isUncommon = uncommonLetters.includes(letter) || veryUncommonLetters.includes(letter);
                
                // If it's uncommon, check if we've already got two uncommon letters
                if (isUncommon && uncommonCount >= 2) {
                    continue;
                }
                
                // Add the letter to the board
                currentBoard.push(letter);
                
                // Update our counter for each letter and each uncommon letters
                letterCounts[letter] = (letterCounts[letter] || 0) + 1;
                if (isUncommon) uncommonCount++;
                
                const letterDiv = document.createElement('div');
                letterDiv.className = 'letter';
                letterDiv.textContent = letter;
                
                // Add styling for uncommonLetters                
                if (uncommonLetters.includes(letter)) {
                    letterDiv.classList.add('uncommon');
                    const bonusSpan = document.createElement('span');
                    bonusSpan.className = 'bonus';
                    bonusSpan.textContent = '+1';
                    letterDiv.appendChild(bonusSpan);
                }                
                // Add styling for veryUncommonLetters !!
                else if (veryUncommonLetters.includes(letter)) {
                    letterDiv.classList.add('very-uncommon');
                    const bonusSpan = document.createElement('span');
                    bonusSpan.className = 'bonus';
                    bonusSpan.textContent = '+2';
                    letterDiv.appendChild(bonusSpan);
                }
                
                board.appendChild(letterDiv);
            }
        }
        
        function copyScoreBoard(lettersBoard){
            
            scoreBoard = []
            
            for (i = 0; i < lettersBoard.length; i++) {
                let letterScore = columnScores[i % 4]
                const letter = lettersBoard[i]
                
                if (uncommonLetters.includes(letter)) {
                    letterScore += 1;
                } else if (veryUncommonLetters.includes(letter)) {
                    letterScore += 2;
                }
                
                scoreBoard.push( [letter,letterScore] )
            }
            
            scoreBoard.sort((a,b) => b[1] - a[1] )
            return scoreBoard
        }
        
        function scoreWord(word) {
            totalScore = 0;
            
            let scoreBoard = copyScoreBoard(currentBoard)
            console.log("original ScoreBoard:", scoreBoard.map(a=>a[0]))
            
            word = word.toUpperCase()
            
            for (let i = 0; i < word.length; i++) {
                const letter = word[i].toUpperCase();
                const scoredLetter = scoreBoard.find( a => {
                    return a[0] == letter
                })
                
                console.log("letter found!:", scoredLetter)
                
                if (scoredLetter != null) {
                    totalScore = totalScore + scoredLetter[1]
                    console.log("Scoring", scoredLetter[1], " current total is:",totalScore)
                    
                    const index = scoreBoard.indexOf(scoredLetter);
                    scoreBoard.splice(index, 1);
                    console.log(scoreBoard.map(a=>a[0]))
                }
            }
            
            return totalScore;
        }
        
        // Timer functions
        function startTimer() {
            if (isTimerRunning) return;
            
            isTimerRunning = true;
            timeRemaining = 30;
            document.getElementById('startTimer').disabled = true;
            document.getElementById('timerDisplay').textContent = timeRemaining;
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                document.getElementById('timerDisplay').textContent = timeRemaining;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    isTimerRunning = false;
                    showBellOverlay();
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            isTimerRunning = false;
            timeRemaining = 30;
            document.getElementById('timerDisplay').textContent = timeRemaining;
            document.getElementById('startTimer').disabled = false;
        }
        
        function showBellOverlay() {
            const overlay = document.getElementById('bellOverlay');
            overlay.classList.add('show', 'jiggle');
        }
        
        function hideBellOverlay() {
            const overlay = document.getElementById('bellOverlay');
            overlay.classList.remove('show', 'jiggle');
        }
        
        // Scoring list functions
        function updateScoredWordsList() {
            const listContainer = document.getElementById('scoredWordsList');
            listContainer.innerHTML = '';
            
            if (scoredWords.length === 0) {
                return;
            }
            
            scoredWords.forEach(item => {
                const wordItem = document.createElement('div');
                wordItem.className = 'scored-word-item';
                wordItem.textContent = `${item.word}: ${item.score}`;
                listContainer.appendChild(wordItem);
            });
        }
        
        function saveWord(word) {
            if (!word || word.trim() === '') return;
            
            const score = scoreWord(word);
            scoredWords.push({
                word: word.toUpperCase(),
                score: score
            });
            updateScoredWordsList();
        }
        
        // Event listeners
        document.getElementById('startTimer').addEventListener('click', startTimer);
        
        document.getElementById('wordInput').addEventListener('input', function() {
            const word = this.value;
            const score = scoreWord(word);
            console.log("Scored word as:", score)
            document.getElementById('score').textContent = `Score: ${score}`;
        });
        
        document.getElementById('wordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const word = this.value.trim();
                if (word) {
                    saveWord(word);
                    this.value = '';
                    document.getElementById('score').textContent = 'Score: 0';
                }
            }
        });
        
        // Reset button
        document.getElementById('resetButton').addEventListener('click', function() {
            stopTimer();
            scoredWords = [];
            updateScoredWordsList();
            generateBoard();
            document.getElementById('wordInput').value = '';
            document.getElementById('score').textContent = 'Score: 0';
            hideBellOverlay();
        });
        
        generateBoard();
        
        // https://stackoverflow.com/questions/52467896/transform-scale-using-viewport-units
        function setVwScale(){
            const range = 1 / 400;
            document.documentElement.style.setProperty('--vw-scale', `${range * Math.min(window.innerWidth, window.innerHeight)}`);
        }
        setVwScale()
        
        window.addEventListener('resize', setVwScale);
    </script>
</body>
</html>
